---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
const latestPosts = posts.slice(0, 3);
const olderPosts = posts.slice(3, 9);
---

<!doctype html>
<html lang="ja">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			/* === Hero Section === */
			.hero {
				text-align: center;
				padding: 4rem 1rem 2.5rem;
				max-width: 720px;
				margin: 0 auto;
			}

			.hero h1 {
				font-size: clamp(2.25rem, 5vw, 3.25rem);
				font-weight: 700;
				color: var(--color-on-surface);
				margin: 0 0 0.75rem;
				line-height: 1.2;
			}

			.hero h1 span {
				color: var(--color-primary);
			}

			.hero .tagline {
				font-size: 1.0625rem;
				color: var(--color-on-surface-variant);
				margin: 0 0 2rem;
				line-height: 1.7;
			}

			/* === Section Title === */
			.section-title {
				font-size: 1.375rem;
				font-weight: 700;
				color: var(--color-on-surface);
				margin: 2.5rem 0 1.25rem;
				padding-bottom: 0.5rem;
				border-bottom: 3px solid var(--color-outline);
				display: inline-block;
			}

			/* === Posts Grid === */
			.latest-posts {
				max-width: 960px;
				margin: 0 auto;
				padding: 0 1rem;
			}

			.featured {
				display: grid;
				grid-template-columns: 1fr;
				gap: 1.5rem;
				margin-bottom: 2.5rem;
			}

			.featured-card {
				display: flex;
				gap: 0;
				text-decoration: none;
				color: inherit;
			}

			.featured-card img {
				width: 260px;
				height: 172px;
				object-fit: cover;
				flex-shrink: 0;
				border-right: 3px solid var(--color-outline);
				border-radius: 0;
			}

			.featured-card .card-content {
				padding: 1.5rem;
				display: flex;
				flex-direction: column;
				justify-content: center;
			}

			.featured-card h3 {
				margin: 0 0 0.5rem;
				font-size: 1.125rem;
				font-weight: 600;
				line-height: 1.4;
				color: var(--color-on-surface);
			}

			.featured-card .desc {
				margin: 0 0 0.75rem;
				font-size: 0.9rem;
				color: var(--color-on-surface-variant);
				line-height: 1.6;
				display: -webkit-box;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
				overflow: hidden;
			}

			.featured-card .date {
				margin: 0;
				font-size: 0.8125rem;
				color: var(--color-on-surface-variant);
				font-weight: 500;
			}

			/* === Older Posts Grid === */
			.older-grid {
				display: grid;
				grid-template-columns: repeat(3, 1fr);
				gap: 1.25rem;
				margin-bottom: 2.5rem;
			}

			.older-card {
				display: block;
				text-decoration: none;
				color: inherit;
			}

			.older-card img {
				width: 100%;
				height: 140px;
				object-fit: cover;
				display: block;
				border-bottom: 3px solid var(--color-outline);
				border-radius: 0;
			}

			.older-card .card-content {
				padding: 1rem;
			}

			.older-card h4 {
				margin: 0 0 0.5rem;
				font-size: 0.9375rem;
				font-weight: 600;
				line-height: 1.4;
				color: var(--color-on-surface);
			}

			.older-card .date {
				margin: 0;
				font-size: 0.8125rem;
				color: var(--color-on-surface-variant);
			}

			/* === View All === */
			.view-all {
				text-align: center;
				margin: 2rem 0 3.5rem;
			}

			/* === Features === */
			.features {
				max-width: 960px;
				margin: 0 auto 4rem;
				padding: 0 1rem;
				display: grid;
				grid-template-columns: repeat(3, 1fr);
				gap: 1.5rem;
			}

			/* === Responsive === */
			@media (max-width: 720px) {
				.hero h1 {
					font-size: 1.875rem;
				}

				.featured-card {
					flex-direction: column;
				}

				.featured-card img {
					width: 100%;
					height: 180px;
					border-right: none;
					border-bottom: 3px solid var(--color-outline);
				}

				.older-grid {
					grid-template-columns: 1fr;
				}

				.features {
					grid-template-columns: 1fr;
				}
			}

			@media (min-width: 480px) and (max-width: 720px) {
				.older-grid {
					grid-template-columns: repeat(2, 1fr);
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main id="main-content">
			<section class="hero">
				<h1>Tech<span>Boost</span></h1>
				<p class="tagline">
					Ezark Consulting が運営するエンジニア向け技術ブログ。<br/>
					Web開発・プログラミング・DevOps の実践的なノウハウを発信しています。
				</p>
			</section>

			<section class="latest-posts">
				<h2 class="section-title">最新の記事</h2>
				<div class="featured">
					{latestPosts.map((post) => (
						<a href={`/blog/${post.id}/`} class="neo-card featured-card">
							{post.data.heroImage && (
								<Image width={520} height={344} src={post.data.heroImage} alt="" />
							)}
							<div class="card-content">
								<h3>{post.data.title}</h3>
								<p class="desc">{post.data.description}</p>
								<p class="date"><FormattedDate date={post.data.pubDate} /></p>
							</div>
						</a>
					))}
				</div>

				{olderPosts.length > 0 && (
					<>
						<h2 class="section-title">その他の記事</h2>
						<div class="older-grid">
							{olderPosts.map((post) => (
								<a href={`/blog/${post.id}/`} class="neo-card older-card">
									{post.data.heroImage && (
										<Image width={400} height={280} src={post.data.heroImage} alt="" />
									)}
									<div class="card-content">
										<h4>{post.data.title}</h4>
										<p class="date"><FormattedDate date={post.data.pubDate} /></p>
									</div>
								</a>
							))}
						</div>
					</>
				)}

				<div class="view-all">
					<a href="/blog" class="neo-btn">すべての記事を見る</a>
				</div>
			</section>

			<section class="features" aria-label="サービス紹介">
				<!-- Code icon (Lucide) -->
				<div class="feature-box">
					<svg
						xmlns="http://www.w3.org/2000/svg"
						width="32"
						height="32"
						viewBox="0 0 24 24"
						fill="none"
						stroke="currentColor"
						stroke-width="2"
						stroke-linecap="round"
						stroke-linejoin="round"
						aria-hidden="true"
					>
						<polyline points="16 18 22 12 16 6"/>
						<polyline points="8 6 2 12 8 18"/>
					</svg>
					<h3>実践的なコード</h3>
					<p>コピペで使えるサンプルコードと、現場で役立つベストプラクティスを紹介します。</p>
				</div>

				<!-- Wrench icon (Lucide) -->
				<div class="feature-box">
					<svg
						xmlns="http://www.w3.org/2000/svg"
						width="32"
						height="32"
						viewBox="0 0 24 24"
						fill="none"
						stroke="currentColor"
						stroke-width="2"
						stroke-linecap="round"
						stroke-linejoin="round"
						aria-hidden="true"
					>
						<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
					</svg>
					<h3>無料ツール</h3>
					<p><a href="https://usedevtools.com">DevToolBox</a> で開発者向けの無料ツールを公開中。CSS変換、JSON整形、OGPプレビューなど。</p>
				</div>

				<!-- BookOpen icon (Lucide) -->
				<div class="feature-box">
					<svg
						xmlns="http://www.w3.org/2000/svg"
						width="32"
						height="32"
						viewBox="0 0 24 24"
						fill="none"
						stroke="currentColor"
						stroke-width="2"
						stroke-linecap="round"
						stroke-linejoin="round"
						aria-hidden="true"
					>
						<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
						<path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
					</svg>
					<h3>チートシート</h3>
					<p><a href="https://ezark-devtools.booth.pm/">BOOTH</a> で実務に使えるチートシートを販売中。React、Python、Docker など。</p>
				</div>
			</section>
		</main>
		<Footer />
	</body>
</html>
